<head>
  <meta charset="UTF-8">
  <title>DOE Calculation Practice</title>
</head>
<h1 style="margin-bottom:0px">SciBowl Physics Calculation Practice</h1>
<h2 id="filter" style="font-weight: normal;"></h2>
<p style="font-size:0.8em;font-style:italic;">Always assume no friction or air resistance and <var>g</var>=9.8m/s<sup>2</sup>. You may use the function <code style="font-style: normal;">sqrt()</code>, or the keyword <code style="font-style: normal;">infinity</code>.</p>

<p id="qdisplay" style="margin-top: 1em;"></p>
<form id="qanswerform" autocomplete="off"><input id="qanswer"><input type="submit" value="Submit"></form>
<p><button id="qgiveup">Give Up</button><p>

<div>
<h2>Tags</h2>
<ul id="taglist"><li><a href="?">[all]</a></li></ul>
</div>

<script>
const g = 9.8;
var questions = [
  {
    tags: ["circuits"],
    strs: ["What is the total capacitance in farads of a {n1} farad capacitor and a {n2} farad capacitor in series?",
      "What is the total resistance in ohms of a {n1} ohm resistor and a {n2} ohm resistor in parallel?",
      "What is the total inductance in henries of a {n1} henry inductor and a {n2} henry inductor in parallel, but well separated?"],
    ans: (n1, n2) => n1 * n2 / (n1 + n2),
    n1: [1,10], n2: [1,10]
  },{
    tags: ["circuits"],
    strs: ["What is the total capacitance in farads of a {n1} farad capacitor and a {n2} farad capacitor in parallel?",
      "What is the total resistance in ohms of a {n1} ohm resistor and a {n2} ohm resistor in series?",
      "What is the total inductance in henries of a {n1} henry inductor and a {n2} henry inductor in series?"],
    ans: (n1, n2) => n1 + n2,
    n1: [1,10], n2: [1,10]
  },{
    tags: ["circuits"],
    strs: ["What is the voltage in volts across a resistor of {n1} ohms with {n2} amperes flowing across it?",
      "What is the electromotive force in volts driving {n1} amperes through a circuit if its total resistance is {n2} ohms?",
      "What is the power in watts dissipated by a resistor when {n1} volts drive {n2} amperes of current through it?"],
    ans: (n1, n2) => n1 * n2,
    n1: [1,10], n2: [1,10]
  },{
    tags: ["circuits"],
    strs: ["What is the resistance in ohms of a circuit if {n1} volts drives {n2} amperes through the circuit?",
      "What is the current in amperes through a resistor of {n2} ohms when a voltage of {n1} volts is placed across it?",
      "What is the voltage in volts necessary to dissipate {n1} watts with a current of {n2} amperes?",
      "What is the current in amperes flowing through a circuit connected to a battery of {n2} volts when it is dissipating {n1} watts of power?"],
    ans: (n1, n2) => n1 / n2,
    n1: [1,10], n2: [1,10]
  },{
    tags: ["circuits"],
    strs: ["What is the power in watts dissipated if {V} volts are placed across a resistor of {R} ohms?"],
    ans: (V, R) => V * V / R,
    V: [1,10], R: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the centripetal acceleration in meters per second squared of an object moving around a circle of radius {r} at a velocity of {v} m/s?"],
    ans: (v, r) => v * v / r,
    v: [1,10], r: [1,10]
  },{
    tags: ["circuits"],
    strs: ["What is the power in watts dissipated if {n1} amps are flowing through a resistor of {n2} ohms?"],
    ans: (n1, n2) => n1 * n1 * n2,
    n1: [1,10], n2: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the centripetal acceleration in meters per second squared of an object moving around a circle of radius {n2} meters at an angular velocity of {n1} radians per second?",
      "What is the moment of inertia in kg&middot;m<sup>2</sup> of a thin hoop of radius {n1} meters and mass {n2} kg?"],
    ans: (n1, n2) => n1 * n1 * n2,
    n1: [1,10], n2: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the kinetic energy in joules of an object of mass {n1} kg moving at {n2} m/s?",
      "What is the moment of inertia in kg&middot;m<sup>2</sup> around the cylindrical axis of a cylinder of mass {n1} kg, radius {n2} meters, and height {n3} meters?"],
    ans: (n1, n2, n3) => n1 * n2 * n2 / 2,
    n1: [1,10], n2: [1,10], n3: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the gravitational potential energy in joules with respect to the ground of a {m} kg object {h} meters above the ground?"],
    ans: (m, h) => m * g * h,
    m: [1,10], h: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the speed in meters per second of a {m} kg object after falling {h} meters from rest?"],
    ans: (m, h) => sqrt(2 * g * h),
    m: [1,10], h: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["How long in seconds does it take for an object of mass {m} kg to fall {h} meters?"],
    ans: (m, h) => sqrt(2 * h / g),
    m: [1,10], h: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["How many meters does an object of mass {m} kg fall in {t} seconds?"],
    ans: (m, t) => 0.5 * g * t * t,
    m: [1,10], t: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What force of friction in newtons is exerted on a sliding {n2} N object given that the coefficient of kinetic friction is 0.{n1}?"],
    ans: (n1, n2) => n1 * n2 / 10,
    n1: [1,9], n2: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the power in watts of an engine exerting a constant {n1},000 N on a car moving at {n2} m/s?"],
    ans: (n1, n2) => n1*n2*1000,
    n1: [1,10], n2: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the force in newtons required to keep an object of mass {m} kg moving at a velocity of {v} m/s in a circle of radius {r} meters?"],
    ans: (m, v, r) => m * v * v / r,
    m: [1,10], v: [1,10], r: [1,10]
  },{
    tags: ["mechanics"],
    strs: ["What is the moment of inertia of a thick cylindrical shell of mass {m} kg with inner radius {r1} meters and outer radius {r2} meters?"],
    ans: (r1, r2, m) => m * (r1*r1 + r2*r2) / 2,
    r1: [1,5], r2: [6,10], m: [1,10]
  },{
    tags: ["quadratics"],
    strs: ["Find the larger root of the quadratic {a}x<sup>2</sup> + {b}x + {c}."],
    init: function(){
      var p1 = rand(-10,10,[0]),//r = p/q, (qx - p) = 0
          q1 = rand(-10,10,[0]),
          p2 = rand(-10,10,[0]),
          q2 = rand(-10,10,[0]);
      
      return {
        a: q1 * q2,
        b: - q1 * p2 - q2 * p1,
        c: p1 * p2,
        ans: Math.max(p1/q1, p2/q2)
      };
    },
  },{
    tags: ["trig"],
    strs: ["Find the {func} of the angle {angle}."],
    init: function() {
      const funcs = ["sine", "cosine", "tangent", "secant", "cosecant", "cotangent"];
      const funcsEval = [Math.sin, Math.cos, Math.tan, x=>1/Math.cos(x), x=>1/Math.sin(x), x=>1/Math.tan(x)];
      const angleDegrees = 15 * Math.floor(Math.random() * 49) - 360;
      let angle = "";
      
      if (Math.random() > 0.5) {
        angle = angleDegrees + "°";
      } else {
        const frac = reduceFraction(angleDegrees, 180);
        if (frac[0] == 0)
          angle = "0";
        else if (frac[0] == 1)
          angle = "π";
        else if (frac[0] == -1)
          angle = "-π";
        else
          angle = frac[0] + "π";
        
        if (frac[1] != 1)
          angle += "/" + frac[1];
      }
      
      const funcIndex = Math.floor(Math.random() * 6);
      
      return {
        func: funcs[funcIndex],
        angle: angle,
        ans: funcsEval[funcIndex](angleDegrees * Math.PI / 180)
      };
    },
  },{
    tags: ["relativity"],
    strs: ["If two spaceships move in opposite directions at 0.{n1}c and 0.{n2}c in the rest frame, what is the relative velocity of one as measured from the other, as a multiple of c?"],
    ans: (n1, n2) => (n1 + n2) / 10 / (1 + n1 * n2 / 100),
    n1: [1,9], n2: [1,9]
  },{
    tags: ["geometricoptics"],
    strs: ["If an object is placed {o} centimeters in front of a converging lens of focal length {f}cm, what is the image distance with Cartesian sign convention?"],
    ans: (o, f) => 1/(1/f - 1/o),
    o: [1,10], f: [1,10]
  },{
    tags: ["geometricoptics"],
    strs: ["How far in front of a converging lens of focal length {f}cm is an object if it produces an image {i} centimeters behind it?"],
    ans: (i, f) => 1/(1/f - 1/i),
    i: [1,10], f: [1,10]
  },{
    tags: ["geometricoptics"],
    strs: ["What is the focal length of a lens if an object placed {o} centimeters in front of it produces an image {i} centimeters behind it?"],
    ans: (o, i) => 1/(1/i + 1/o),
    o: [1,10], i: [1,10]
  }/*,{
    tags: [],
    strs: ["?"],
    ans: (n1, n2) => n1 + n2,
    n1: [1,10], n2: [1,10]
  }*/
];

const byId = id => document.getElementById(id);

// Get sorted list of unique tags
let allTags = questions.flatMap(x=>x.tags).filter(x=>x);
allTags = [...new Set(allTags)];
allTags.sort();
for (const tag of allTags) {
  byId("taglist").innerHTML+=`<li><a href="?filter=${tag}">${tag}</a></li>`;
}

//http://stackoverflow.com/a/979995/1181387
var QueryString = function () {
  // This function is anonymous, is executed immediately and 
  // the return value is assigned to QueryString!
  var query_string = {};
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
        // If first entry with this name
    if (typeof query_string[pair[0]] === "undefined") {
      query_string[pair[0]] = decodeURIComponent(pair[1]);
        // If second entry with this name
    } else if (typeof query_string[pair[0]] === "string") {
      var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
      query_string[pair[0]] = arr;
        // If third or later entry with this name
    } else {
      query_string[pair[0]].push(decodeURIComponent(pair[1]));
    }
  } 
    return query_string;
}();

if(QueryString.hasOwnProperty("filter")){
  console.log(QueryString["filter"]);
  var newquestions = questions.filter(function(q){
     return !q.hasOwnProperty("tags") || 
            q["tags"].indexOf(QueryString["filter"]) != -1;
  });
  if(newquestions.length == 0)
    alert("No questions with filter '"+QueryString["filter"]+"'.");
  else{
    questions = newquestions;
    byId("filter").innerHTML = "(filter: <i>"+QueryString["filter"]+"</i>)";
  }
}



function gcd(a,b){
  if(!b) return a;
  return gcd(b, a%b);
}
function reduceFraction(f, q){//[p,q]
  if(typeof f == "number")
    f = [f, q];
  
  var g = gcd(f[0],f[1]);
  if(f[1]/g < 0)
    g = -g;
  return [f[0]/g, f[1]/g];
}

const sqrt = Math.sqrt; //for eval
function rand(a,b,exclude){//inclusive
  if(typeof exclude != "object")
    exclude = [];
  var rand;
  do{
    rand = Math.floor(a+(b-a+1)*Math.random());
  }while(exclude.indexOf(rand) != -1);
  return rand;
}
function getParamNames(func) {
  var STRIP_COMMENTS = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;
  var ARGUMENT_NAMES = /([^\s,]+)/g;
  var fnStr = func.toString().replace(STRIP_COMMENTS, '');
  var result = fnStr.slice(fnStr.indexOf('(')+1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);
  if(result === null)
    result = [];
  return result;
}

(function(Questioner, questions, display, ansform, ansbox, giveupbtn, undefined){
  function randQuestionIndices(){
    var totalSize = 0;
    for(var i = 0; i < questions.length; i++)
      totalSize+=questions[i].strs.length;
    var totalIndex = Math.floor(Math.random()*totalSize);
    for(var i = 0; i < questions.length; i++)
      if(totalIndex >= questions[i].strs.length)totalIndex -= questions[i].strs.length;
      else return [i,totalIndex];
  }
  
  var ANSWER;
  Questioner.loadNext = function(){
    var inds = randQuestionIndices();
    var q = questions[inds[0]];
    var qtext = q.strs[inds[1]];
    
    if(typeof q.init === "function"){
      var dict = q.init();
      for(var argname in dict)
        if(argname != "ans")
          qtext = qtext.replace("{"+argname+"}", dict[argname]);
      ANSWER = dict.ans;
    }
    else {
      let argsToAns = [];
      const paramnames = getParamNames(q.ans);
      for (const argname of paramnames){
        const randarg = rand(...q[argname]);
        argsToAns[argsToAns.length] = randarg;
        qtext = qtext.replace("{"+argname+"}", randarg);
      }
      ANSWER = q.ans.apply(this, argsToAns);
    }
    
    display.innerHTML = qtext;
    ansbox.focus();
  };
  Questioner.check = function(e){
    var evaled = "";
    var done = false;
    try{
      evaled = (function(ANSWER, Questioner, window){
        if(ansbox.value.toLowerCase()=="infinity")
          return "infinity";
        else
          return eval(ansbox.value);
      })();
    }
    catch(e){
      alert("INCORRECT - error reading your answer of '"+ansbox.value+"'");
      done = true;
    }
    if(!done){
      if(typeof ANSWER == "number" && Math.abs((ANSWER-evaled)/ANSWER) < 0.00001  //Within 0.001% rounding error
          || evaled == "infinity" && Math.abs(ANSWER) > 100000000000              //"Infinite"
          || evaled == ANSWER){                                                   //Exact match
        alert(`${ansbox.value} is CORRECT (${+ANSWER.toFixed(3)})`);
        ansbox.value = "";
        Questioner.loadNext();
      }else{
        alert(`${ansbox.value} is INCORRECT`);
      }
    }
    
    
    if(!e)var e=window.event;
    e.preventDefault();
    return false;
  };
  Questioner.giveup = function(e){
    alert(`The correct answer is ${+ANSWER.toFixed(3)}.`);
    ansbox.value = "";
    Questioner.loadNext();
    
    if(!e)var e=window.event;
    e.preventDefault();
    return false;
  };
  
  window.onkeypress = ansbox.focus;
  ansform.onsubmit=Questioner.check;
  giveupbtn.onclick=Questioner.giveup;
  
  Questioner.loadNext();
})(window.Questioner = window.Questioner || {}, questions, byId("qdisplay"), byId("qanswerform"), byId("qanswer"), byId("qgiveup"));


// to add
  //make a timer (and leaderboard)
  //no more alerts - make the textbox flash green or red

</script>
